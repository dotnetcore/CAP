import{c as i,n as o,B as c,e as d,f as u,b as f}from"./index.8eb375a0.js";var l=i.CancelToken.source();const p={components:{BIconInfoCircleFill:c,BIconSpeedometer2:d,BIconArrowClockwise:u,BIconSearch:f},data(){return{pinging:!1,selected:null,nsList:[],isBusy:!1,items:[]}},computed:{fields(){return[{key:"id",label:this.$t("Id")},{key:"name",label:this.$t("Node Name"),tdClass:"text-left"},{key:"address",label:this.$t("Ip Address"),tdClass:"text-left"},{key:"tags",label:this.$t("Tags"),tdClass:"text-left"},{key:"latency",label:this.$t("Latency"),thClass:"text-center",tdClass:"text-success"},{key:"actions",label:this.$t("Actions"),thClass:"text-center"}]}},mounted(){this.fetchNsOptions(),this.fetchData()},methods:{colWidth(n){switch(n){case"address":return"320px";case"actions":return"80px";case"latency":return"60px";default:return""}},fetchNsOptions(){this.isBusy=!0,i.get("/list-ns").then(e=>{e.data.length>0&&(this.nsList=e.data)}),this.isBusy=!1;var n=this.getCookie("cap.node.ns");n&&(this.selected=n,this.fetchSvcs())},fetchSvcs(){if(!!this.selected){this.isBusy=!0;var n=this.getCookie("cap.node");this.pinging==!0&&(l.cancel(),l=i.CancelToken.source()),i.get("/list-svc/"+this.selected).then(e=>{for(var t of e.data)t.name==n&&(t._rowVariant="dark"),t._ping=!1;this.items=e.data,this.isBusy=!1})}},async pingSvcs(){var t;this.pinging=!0;for(var n of this.items)try{var e=await i.get("/ping",{params:{endpoint:n.address+":"+n.port},timeout:3e3,cancelToken:l.token});n.latency=e.data}catch(s){if(i.isCancel(s))break;n.latency=(t=s.response)==null?void 0:t.data}this.pinging=!1},fetchData(){this.isBusy=!0;var n=this.getCookie("cap.node");i.get("/nodes").then(e=>{for(var t of e.data)t.name==n&&(t._rowVariant="dark");this.items=e.data,this.isBusy=!1})},switchNode(n){n._ping=!0,i.get("/ping",{params:{endpoint:n.address+":"+n.port},timeout:3e3}).then(e=>{n.latency=e.data,document.cookie=`cap.node=${escape(n.name)};`,document.cookie=`cap.node.ns=${this.selected};`,n._ping=!1,location.reload()}).catch(e=>{var t;i.isAxiosError(e)&&(n.latency=(t=e.response)==null?void 0:t.data,this.$bvToast.toast("Switch to ["+n.name+"] failed! Endpoint: "+n.address,{title:"Warning",variant:"danger",autoHideDelay:2e3,appendToast:!0,solid:!0})),n._ping=!1})},getCookie(n){for(var e=n+"=",t=decodeURIComponent(document.cookie),s=t.split(";"),a=0;a<s.length;a++){for(var r=s[a];r.charAt(0)==" ";)r=r.substring(1);if(r.indexOf(e)==0)return r.substring(e.length,r.length)}return""}}};var h=function(){var e=this,t=e._self._c;return t("div",[t("h2",{staticClass:"text-left mb-4"},[e._v(e._s(e.$t("Nodes")))]),e.nsList.length>0?t("b-row",{staticClass:"mb-3"},[t("b-col",[t("b-form-select",{attrs:{"value-field":"item","text-field":"name",options:e.nsList},on:{change:function(s){return e.fetchSvcs()}},scopedSlots:e._u([{key:"first",fn:function(){return[t("b-form-select-option",{attrs:{value:null,disabled:""}},[e._v(e._s(e.$t("SelectNamespaces")))])]},proxy:!0}],null,!1,213963292),model:{value:e.selected,callback:function(s){e.selected=s},expression:"selected"}})],1),t("b-col",{attrs:{cols:"1"}},[t("b-button",{attrs:{variant:"dark",disabled:e.selected==null||e.pinging,"aria-disabled":"true",id:"latency"},on:{click:function(s){return e.pingSvcs()}}},[e.pinging?e._e():t("b-icon-speedometer2"),e.pinging?t("b-icon-arrow-clockwise",{attrs:{animation:"spin"}}):e._e()],1)],1)],1):e._e(),t("b-table",{attrs:{fields:e.fields,items:e.items,busy:e.isBusy,small:"","head-variant":"light","show-empty":"",striped:"",hover:"",responsive:"","thead-tr-class":"text-left","empty-text":e.nsList.length==0?e.$t("NonDiscovery"):e.$t("EmptyRecords")},scopedSlots:e._u([{key:"table-colgroup",fn:function(s){return e._l(s.fields,function(a){return t("col",{key:a.key,style:{width:e.colWidth(a.key)}})})}},{key:"table-busy",fn:function(){return[t("div",{staticClass:"text-center text-secondary my-2"},[t("b-spinner",{staticClass:"align-middle"}),t("strong",{staticClass:"ml-2"},[e._v(e._s(e.$t("Loading"))+"...")])],1)]},proxy:!0},{key:"empty",fn:function(s){return[t("h5",{staticClass:"alert alert-info",attrs:{role:"alert"}},[t("b-icon-info-circle-fill"),e._v(" "+e._s(s.emptyText)+" ")],1)]}},{key:"cell(id)",fn:function(s){return[t("div",{staticClass:"texts"},[e._v(" "+e._s(s.item.id)+" ")])]}},{key:"cell(address)",fn:function(s){return[e._v(" "+e._s(s.item.address+(s.item.port==80?"":":"+s.item.port))+" ")]}},{key:"cell(tags)",fn:function(s){return[t("b-badge",{attrs:{variant:"info"}},[e._v(e._s(s.item.tags.split(",")[0]))]),s.item.tags!=""?t("b-link",{on:{click:s.toggleDetails}},[t("div",{staticClass:"ml-2",staticStyle:{"font-size":"12px",color:"gray"}},[e._v("Show "+e._s(s.detailsShowing?"Less":"More")+" ")])]):e._e()]}},{key:"row-details",fn:function(s){return e._l(s.item.tags.split(","),function(a){return t("b-badge",{key:a,staticClass:"mb-1 ml-2"},[e._v(e._s(a))])})}},{key:"cell(latency)",fn:function(s){return[s.item.latency==null?t("div"):typeof s.item.latency=="number"?t("b-badge",{attrs:{variant:"success"}},[e._v(" "+e._s(s.item.latency+" ms")+" ")]):t("b-badge",{directives:[{name:"b-popover",rawName:"v-b-popover.hover.left",value:s.item.latency,expression:"data.item.latency",modifiers:{hover:!0,left:!0}}],attrs:{pill:"",href:"#",variant:"danger",size:"sm",title:"Request failed"}},[e._v(" Error ")])]}},{key:"cell(actions)",fn:function(s){return[t("b-button",{attrs:{size:"sm",variant:"dark"},on:{click:function(a){return e.switchNode(s.item)}}},[s.item._ping?t("b-spinner",{attrs:{small:"",variant:"secondary",type:"grow",label:"Spinning"}}):e._e(),e._v(" "+e._s(e.$t("Switch"))+" ")],1)]}}])})],1)},v=[],g=o(p,h,v,!1,null,null,null,null);const m=g.exports;export{m as default};
