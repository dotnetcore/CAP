import{n as l,B as c,f as d,h as u,b as f,d as i}from"./index-q8KWmGOG.js";var o=new AbortController;const p={components:{BIconInfoCircleFill:f,BIconSpeedometer2:u,BIconArrowClockwise:d,BIconSearch:c},data(){return{pinging:!1,selected:null,nsList:[],isBusy:!1,items:[]}},computed:{fields(){return[{key:"id",label:this.$t("Id")},{key:"name",label:this.$t("Node Name"),tdClass:"text-left"},{key:"address",label:this.$t("Ip Address"),tdClass:"text-left"},{key:"tags",label:this.$t("Tags"),tdClass:"text-left"},{key:"latency",label:this.$t("Latency"),thClass:"text-center",tdClass:"text-success"},{key:"actions",label:this.$t("Actions"),thClass:"text-center"}]}},mounted(){this.fetchNsOptions(),this.fetchData()},methods:{colWidth(n){switch(n){case"address":return"320px";case"actions":return"80px";case"latency":return"60px";default:return""}},fetchNsOptions(){this.isBusy=!0,i.get("/list-ns").then(t=>{t.data.length>0&&(this.nsList=t.data)}),this.isBusy=!1;var n=this.getCookie("cap.node.ns");n&&(this.selected=n,this.fetchSvcs())},fetchSvcs(){if(this.selected){this.isBusy=!0;var n=this.getCookie("cap.node");this.pinging==!0&&(o.abort(),o=new AbortController),i.get("/list-svc/"+this.selected).then(t=>{for(var e of t.data)e.name==n&&(e._rowVariant="dark"),e._ping=!1;this.items=t.data,this.isBusy=!1})}},async pingSvcs(){var e;this.pinging=!0;for(var n of this.items)try{var t=await i.get("/ping",{params:{endpoint:n.address+":"+n.port},timeout:3e3,signal:o.signal});n.latency=t.data}catch(s){if(i.isCancel(s))break;n.latency=(e=s.response)==null?void 0:e.data}this.pinging=!1},fetchData(){this.isBusy=!0;var n=this.getCookie("cap.node");i.get("/nodes").then(t=>{for(var e of t.data)e.name==n&&(e._rowVariant="dark");this.items=t.data,this.isBusy=!1})},switchNode(n){n._ping=!0,i.get("/ping",{params:{endpoint:n.address+":"+n.port},timeout:3e3}).then(t=>{n.latency=t.data,document.cookie=`cap.node=${encodeURIComponent(n.name)};SameSite=Strict`,document.cookie=`cap.node.ns=${encodeURIComponent(this.selected)};SameSite=Strict`,n._ping=!1,location.reload()}).catch(t=>{var e;i.isAxiosError(t)&&(n.latency=(e=t.response)==null?void 0:e.data,this.$bvToast.toast("Switch to ["+n.name+"] failed! Endpoint: "+n.address,{title:"Warning",variant:"danger",autoHideDelay:2e3,appendToast:!0,solid:!0})),n._ping=!1})},getCookie(n){for(var t=n+"=",e=decodeURIComponent(document.cookie),s=e.split(";"),a=0;a<s.length;a++){for(var r=s[a];r.charAt(0)==" ";)r=r.substring(1);if(r.indexOf(t)==0)return r.substring(t.length,r.length)}return""}}};var h=function(){var t=this,e=t._self._c;return e("div",[e("h2",{staticClass:"text-left mb-4"},[t._v(t._s(t.$t("Nodes")))]),t.nsList.length>0?e("b-row",{staticClass:"mb-3"},[e("b-col",[e("b-form-select",{attrs:{"value-field":"item","text-field":"name",options:t.nsList},on:{change:function(s){return t.fetchSvcs()}},scopedSlots:t._u([{key:"first",fn:function(){return[e("b-form-select-option",{attrs:{value:null,disabled:""}},[t._v(t._s(t.$t("SelectNamespaces")))])]},proxy:!0}],null,!1,213963292),model:{value:t.selected,callback:function(s){t.selected=s},expression:"selected"}})],1),e("b-col",{attrs:{cols:"1"}},[e("b-button",{attrs:{variant:"dark",disabled:t.selected==null||t.pinging,"aria-disabled":"true",id:"latency"},on:{click:function(s){return t.pingSvcs()}}},[t.pinging?t._e():e("b-icon-speedometer2"),t.pinging?e("b-icon-arrow-clockwise",{attrs:{animation:"spin"}}):t._e()],1)],1)],1):t._e(),e("b-table",{attrs:{fields:t.fields,items:t.items,busy:t.isBusy,small:"","head-variant":"light","show-empty":"",striped:"",hover:"",responsive:"","thead-tr-class":"text-left","empty-text":t.nsList.length==0?t.$t("NonDiscovery"):t.$t("EmptyRecords")},scopedSlots:t._u([{key:"table-colgroup",fn:function(s){return t._l(s.fields,function(a){return e("col",{key:a.key,style:{width:t.colWidth(a.key)}})})}},{key:"table-busy",fn:function(){return[e("div",{staticClass:"text-center text-secondary my-2"},[e("b-spinner",{staticClass:"align-middle"}),e("strong",{staticClass:"ml-2"},[t._v(t._s(t.$t("Loading"))+"...")])],1)]},proxy:!0},{key:"empty",fn:function(s){return[e("h5",{staticClass:"alert alert-info",attrs:{role:"alert"}},[e("b-icon-info-circle-fill"),t._v(" "+t._s(s.emptyText)+" ")],1)]}},{key:"cell(id)",fn:function(s){return[e("div",{staticClass:"texts"},[t._v(" "+t._s(s.item.id)+" ")])]}},{key:"cell(address)",fn:function(s){return[t._v(" "+t._s(s.item.address+(s.item.port==80?"":":"+s.item.port))+" ")]}},{key:"cell(tags)",fn:function(s){return[e("b-badge",{attrs:{variant:"info"}},[t._v(t._s(s.item.tags.split(",")[0]))]),s.item.tags!=""?e("b-link",{on:{click:s.toggleDetails}},[e("div",{staticClass:"ml-2",staticStyle:{"font-size":"12px",color:"gray"}},[t._v("Show "+t._s(s.detailsShowing?"Less":"More")+" ")])]):t._e()]}},{key:"row-details",fn:function(s){return t._l(s.item.tags.split(","),function(a){return e("b-badge",{key:a,staticClass:"mb-1 ml-2"},[t._v(t._s(a))])})}},{key:"cell(latency)",fn:function(s){return[s.item.latency==null?e("div"):typeof s.item.latency=="number"?e("b-badge",{attrs:{variant:"success"}},[t._v(" "+t._s(s.item.latency+" ms")+" ")]):e("b-badge",{directives:[{name:"b-popover",rawName:"v-b-popover.hover.left",value:s.item.latency,expression:"data.item.latency",modifiers:{hover:!0,left:!0}}],attrs:{pill:"",href:"#",variant:"danger",size:"sm",title:"Request failed"}},[t._v(" Error ")])]}},{key:"cell(actions)",fn:function(s){return[e("b-button",{attrs:{size:"sm",variant:"dark"},on:{click:function(a){return t.switchNode(s.item)}}},[s.item._ping?e("b-spinner",{attrs:{small:"",variant:"secondary",type:"grow",label:"Spinning"}}):t._e(),t._v(" "+t._s(t.$t("Switch"))+" ")],1)]}}])})],1)},m=[],g=l(p,h,m,!1,null,null);const y=g.exports;export{y as default};
